<!-- views/user_nutrition.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymRats - Personalized Nutrition Guide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/nutrition/user_nutrition.css">
    <link rel="stylesheet" type="text/css" href="/userdashboard/userdashboard.css" />
</head>
<body>
    <!-- User Dashboard Header -->
    <div class="main-navbar">
        <header>
            <div class="brand-logo">
                <a href="<%= user && user.membership ? '/userdashboard_' + user.membership.charAt(0).toLowerCase() : '/dashboard' %>" class="brand-name">GymRats</a>
            </div>
            
            <div class="nav-menu">
                <a href="<%= user && user.membership ? '/userdashboard_' + user.membership.charAt(0).toLowerCase() : '/dashboard' %>" class="<%= currentPage === 'dashboard' ? 'active' : '' %>">Home</a>
                <a href="/user_exercises" class="<%= currentPage === 'exercises' ? 'active' : '' %>">Exercises</a>
                <a href="/user_nutrition" class="<%= currentPage === 'nutrition' ? 'active' : '' %>">Nutrition</a>
            </div>
            
            <div class="right-container">
                <div class="search-container">
                    <img src="/userdashboard/icons8-search.svg" height="18px" alt="Search Icon" />
                    <input type="text" placeholder="Search..." size="20" style="font-size: 14px;" />
                </div>
                
                <div class="user-profile">
                    <a href="/userprofile" class="<%= currentPage === 'profile' ? 'active' : '' %>">
                        <% if (user && user.name) { %>
                            <span><%= user.name %></span>
                        <% } else if (user && user.full_name) { %>
                            <span><%= user.full_name.split(' ')[0] %></span>
                        <% } else { %>
                            <span>User</span>
                        <% } %>
                    </a>
                </div>
            </div>
            <div class="mobile-menu-icon" id="menuIcon">
                <img src="/userdashboard/menu.jpg" alt="Menu" height="25px" />
            </div>
            <div class="mobile-sidebar" id="sideNavbar">
                <a href="javascript:void(0)" class="close-button" id="closeBtn">&times;</a>
                <a href="<%= user && user.membership ? '/userdashboard_' + user.membership.charAt(0).toLowerCase() : '/dashboard' %>" class="<%= currentPage === 'dashboard' ? 'active' : '' %>">Home</a>
                <a href="/user_exercises" class="<%= currentPage === 'exercises' ? 'active' : '' %>">Exercises</a>
                <a href="/user_nutrition" class="<%= currentPage === 'nutrition' ? 'active' : '' %>">Nutrition</a>
                <div class="sidebar-profile">
                    <a href="/userprofile">
                        <% if (user && user.name) { %>
                            <span><%= user.name %></span>
                        <% } else if (user && user.full_name) { %>
                            <span><%= user.full_name.split(' ')[0] %></span>
                        <% } else { %>
                            <span>User</span>
                        <% } %>
                    </a>
                </div>
            </div>
        </header>
    </div>

    <!-- Personalized Welcome Banner -->
    <div class="welcome-banner">
        <h1>Welcome, <%= user && user.name ? user.name : 'Athlete' %>!</h1>
        <p>Your Personalized Evidence-Based Nutrition Guide</p>
        <% if (user && user.fitness_goal) { %>
            <div class="goal-badge">
                <i class="fas fa-bullseye"></i>
                Current Goal: <%= user.fitness_goal %>
            </div>
        <% } %>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Personalized Nutrition Overview -->
        <div class="section">
            <h2>Your Nutrition Dashboard</h2>
            <div class="user-metrics-grid">
                <div class="metric-card">
                    <h3>Recommended Daily Intake</h3>
                    <div class="metric-content">
                        <% 
                        // Calculate personalized macros based on user data
                        let proteinRec = '1.6-2.2g/kg';
                        let carbRec = '3-5g/kg';
                        let fatRec = '0.8-1.2g/kg';
                        let calorieRec = 'Maintenance';

                        if (user && user.fitness_goal) {
                            switch(user.fitness_goal.toLowerCase()) {
                                case 'weight loss':
                                    proteinRec = '2.0-2.4g/kg';
                                    carbRec = '2-4g/kg';
                                    fatRec = '0.8-1.2g/kg';
                                    calorieRec = 'Deficit (-300-500 kcal)';
                                    break;
                                case 'muscle gain':
                                    proteinRec = '1.6-2.2g/kg';
                                    carbRec = '4-7g/kg';
                                    fatRec = '0.5-1.5g/kg';
                                    calorieRec = 'Surplus (+200-500 kcal)';
                                    break;
                                case 'strength':
                                    proteinRec = '1.6-2.0g/kg';
                                    carbRec = '3-5g/kg';
                                    fatRec = '0.8-1.5g/kg';
                                    calorieRec = 'Maintenance';
                                    break;
                            }
                        }
                        %>
                        <div class="macro-item">
                            <span class="macro-label">Protein:</span>
                            <span class="macro-value"><%= proteinRec %></span>
                        </div>
                        <div class="macro-item">
                            <span class="macro-label">Carbs:</span>
                            <span class="macro-value"><%= carbRec %></span>
                        </div>
                        <div class="macro-item">
                            <span class="macro-label">Fats:</span>
                            <span class="macro-value"><%= fatRec %></span>
                        </div>
                        <div class="macro-item highlight">
                            <span class="macro-label">Calories:</span>
                            <span class="macro-value"><%= calorieRec %></span>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <h3>Your Training Focus</h3>
                    <div class="metric-content">
                        <% 
                        let trainingFocus = 'General Fitness';
                        let nutritionFocus = 'Balanced Nutrition';
                        
                        if (user && user.fitness_goal) {
                            switch(user.fitness_goal.toLowerCase()) {
                                case 'weight loss':
                                    trainingFocus = 'Fat Loss & Conditioning';
                                    nutritionFocus = 'Calorie Deficit & Protein Priority';
                                    break;
                                case 'muscle gain':
                                    trainingFocus = 'Hypertrophy & Volume';
                                    nutritionFocus = 'Calorie Surplus & Recovery';
                                    break;
                                case 'strength':
                                    trainingFocus = 'Strength & Power';
                                    nutritionFocus = 'Performance Fueling';
                                    break;
                            }
                        }
                        %>
                        <div class="focus-item">
                            <i class="fas fa-dumbbell"></i>
                            <span><%= trainingFocus %></span>
                        </div>
                        <div class="focus-item">
                            <i class="fas fa-apple-alt"></i>
                            <span><%= nutritionFocus %></span>
                        </div>
                        <% if (user && user.experience_level) { %>
                        <div class="focus-item">
                            <i class="fas fa-chart-line"></i>
                            <span>Level: <%= user.experience_level %></span>
                        </div>
                        <% } %>
                    </div>
                </div>

                <div class="metric-card">
                    <h3>Daily Hydration Target</h3>
                    <div class="metric-content">
                        <div class="hydration-target">
                            <i class="fas fa-tint"></i>
                            <span>3-4 Liters</span>
                        </div>
                        <p class="hydration-note">Adjust based on training intensity and environment</p>
                        <div class="hydration-tips">
                            <h4>Hydration Tips:</h4>
                            <ul>
                                <li>500ml upon waking</li>
                                <li>250ml every 2 hours</li>
                                <li>Extra 500ml per hour of training</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Goal-Specific Nutrition Strategies -->
        <div class="section">
            <h2>Nutrition Strategy for <%= user && user.fitness_goal ? user.fitness_goal : 'Your Goals' %></h2>
            
            <div class="nutrition-grid">
                <% if (!user || !user.fitness_goal || user.fitness_goal.toLowerCase() === 'muscle gain') { %>
                <!-- Muscle Gain Focus -->
                <div class="nutrition-card strategy-card">
                    <h3><i class="fas fa-weight-hanging"></i> Hypertrophy Nutrition</h3>
                    <div class="strategy-highlights">
                        <div class="highlight-item">
                            <strong>Caloric Surplus:</strong> +200-500 kcal daily
                        </div>
                        <div class="highlight-item">
                            <strong>Protein Priority:</strong> 1.6-2.2g/kg bodyweight
                        </div>
                        <div class="highlight-item">
                            <strong>Carb Timing:</strong> Higher around workouts
                        </div>
                    </div>
                    <div class="meal-timing">
                        <h4>Optimal Meal Timing:</h4>
                        <ul>
                            <li>Pre-workout: 30-60g carbs + 20-30g protein (1-2 hours before)</li>
                            <li>Post-workout: 40-80g carbs + 25-40g protein (within 2 hours)</li>
                            <li>Evenly distribute remaining protein across 3-4 meals</li>
                        </ul>
                    </div>
                </div>
                <% } %>

                <% if (user && user.fitness_goal && user.fitness_goal.toLowerCase() === 'weight loss') { %>
                <!-- Weight Loss Focus -->
                <div class="nutrition-card strategy-card">
                    <h3><i class="fas fa-fire"></i> Fat Loss Nutrition</h3>
                    <div class="strategy-highlights">
                        <div class="highlight-item">
                            <strong>Caloric Deficit:</strong> -300-500 kcal daily
                        </div>
                        <div class="highlight-item">
                            <strong>High Protein:</strong> 2.0-2.4g/kg to preserve muscle
                        </div>
                        <div class="highlight-item">
                            <strong>Fiber Focus:</strong> 30-40g daily for satiety
                        </div>
                    </div>
                    <div class="meal-timing">
                        <h4>Strategic Eating Pattern:</h4>
                        <ul>
                            <li>Protein with every meal (30-40g)</li>
                            <li>Larger meals before and after training</li>
                            <li>Consider time-restricted eating (14-16 hour fasts)</li>
                            <li>Focus on nutrient-dense, low-calorie foods</li>
                        </ul>
                    </div>
                </div>
                <% } %>

                <% if (user && user.fitness_goal && user.fitness_goal.toLowerCase() === 'strength') { %>
                <!-- Strength Focus -->
                <div class="nutrition-card strategy-card">
                    <h3><i class="fas fa-bolt"></i> Strength Performance Nutrition</h3>
                    <div class="strategy-highlights">
                        <div class="highlight-item">
                            <strong>Maintenance Calories:</strong> Focus on performance
                        </div>
                        <div class="highlight-item">
                            <strong>Adequate Protein:</strong> 1.6-2.0g/kg for recovery
                        </div>
                        <div class="highlight-item">
                            <strong>Strategic Carbs:</strong> Around training sessions
                        </div>
                    </div>
                    <div class="meal-timing">
                        <h4>Training Day Nutrition:</h4>
                        <ul>
                            <li>Pre-workout: Focus on easily digestible carbs</li>
                            <li>Intra-workout: BCAAs or electrolytes if needed</li>
                            <li>Post-workout: Rapidly digestible protein + carbs</li>
                            <li>Emphasize recovery nutrition between sessions</li>
                        </ul>
                    </div>
                </div>
                <% } %>

                <!-- Supplement Recommendations -->
                <div class="nutrition-card supplement-recs">
                    <h3><i class="fas fa-capsules"></i> Recommended Supplements</h3>
                    <div class="supplement-list">
                        <div class="supplement-item essential">
                            <h4>Essential</h4>
                            <ul>
                                <li>
                                    <strong>Creatine Monohydrate:</strong> 3-5g daily
                                    <span class="benefit">Strength & power output</span>
                                </li>
                                <li>
                                    <strong>Whey Protein:</strong> As needed for protein targets
                                    <span class="benefit">Muscle recovery</span>
                                </li>
                            </ul>
                        </div>
                        <div class="supplement-item conditional">
                            <h4>Conditional</h4>
                            <ul>
                                <% if (user && user.fitness_goal && user.fitness_goal.toLowerCase() === 'weight loss') { %>
                                <li>
                                    <strong>Caffeine:</strong> Pre-workout
                                    <span class="benefit">Performance & fat oxidation</span>
                                </li>
                                <% } %>
                                <li>
                                    <strong>Vitamin D:</strong> 1000-2000 IU daily
                                    <span class="benefit">Immune function & bone health</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Science-Based Nutrition Section -->
        <div class="section">
            <h2>Evidence-Based Nutrition Principles</h2>
            
            <div class="nutrition-grid">
                <div class="nutrition-card research-card">
                    <h3>Protein Distribution</h3>
                    <p>Research shows distributing protein intake evenly throughout the day (20-40g per meal) maximizes muscle protein synthesis.</p>
                    <div class="research-link">
                        <i class="fas fa-file-alt"></i>
                        <a href="https://pubmed.ncbi.nlm.nih.gov/24257722/" target="_blank">Mamerow et al. (2014)</a>
                    </div>
                    <div class="personal-application">
                        <strong>Your Application:</strong> Aim for 4-6 protein-rich meals spaced 3-4 hours apart
                    </div>
                </div>

                <div class="nutrition-card research-card">
                    <h3>Carbohydrate Timing</h3>
                    <p>Strategic carb intake around training sessions optimizes performance and recovery while maintaining metabolic flexibility.</p>
                    <div class="research-link">
                        <i class="fas fa-file-alt"></i>
                        <a href="https://pubmed.ncbi.nlm.nih.gov/29453741/" target="_blank">Impey et al. (2018)</a>
                    </div>
                    <div class="personal-application">
                        <strong>Your Application:</strong> Consume majority of daily carbs before and after training
                    </div>
                </div>

                <div class="nutrition-card research-card">
                    <h3>Hydration & Performance</h3>
                    <p>Even mild dehydration (2% body weight) can significantly impair strength, power, and endurance performance.</p>
                    <div class="research-link">
                        <i class="fas fa-file-alt"></i>
                        <a href="https://pubmed.ncbi.nlm.nih.gov/28935558/" target="_blank">Judge et al. (2016)</a>
                    </div>
                    <div class="personal-application">
                        <strong>Your Application:</strong> Monitor urine color and drink consistently throughout day
                    </div>
                </div>
            </div>
        </div>

        <!-- Member-Exclusive Resources -->
        <div class="section membership-section <%= user && user.membership ? user.membership.toLowerCase() : 'basic' %>-tier">
            <h2>
                <i class="fas fa-crown"></i>
                <%= user && user.membership ? user.membership : 'Basic' %> Member Resources
            </h2>
            
            <div class="nutrition-grid">
                <% if (user && user.membership && user.membership.toLowerCase() !== 'basic') { %>
                <!-- Premium Content -->
                <div class="nutrition-card premium-feature">
                    <h3>Personalized Macro Calculator</h3>
                    <p>Your custom macro breakdown based on your body composition and training schedule.</p>
                    <div class="premium-content">
                        <% 
                        // Sample personalized calculation
                        let weight = user.weight || 70; // default weight
                        let calculatedProtein = Math.round(weight * 1.8);
                        let calculatedCarbs = Math.round(weight * 4);
                        let calculatedFat = Math.round(weight * 0.9);
                        let calculatedCalories = calculatedProtein * 4 + calculatedCarbs * 4 + calculatedFat * 9;
                        %>
                        <div class="macro-breakdown">
                            <div class="macro-detail">
                                <span>Protein: <%= calculatedProtein %>g</span>
                                <span><%= Math.round(calculatedProtein * 4 / calculatedCalories * 100) %>%</span>
                            </div>
                            <div class="macro-detail">
                                <span>Carbs: <%= calculatedCarbs %>g</span>
                                <span><%= Math.round(calculatedCarbs * 4 / calculatedCalories * 100) %>%</span>
                            </div>
                            <div class="macro-detail">
                                <span>Fat: <%= calculatedFat %>g</span>
                                <span><%= Math.round(calculatedFat * 9 / calculatedCalories * 100) %>%</span>
                            </div>
                            <div class="total-calories">
                                Total: <%= calculatedCalories %> kcal
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nutrition-card premium-feature">
                    <h3>Advanced Meal Timing</h3>
                    <p>Optimize your meal schedule based on your training times and personal preferences.</p>
                    <div class="premium-content">
                        <div class="meal-schedule">
                            <div class="meal-time">
                                <strong>7:00 AM</strong> - Pre-workout meal (if training AM)
                            </div>
                            <div class="meal-time">
                                <strong>8:00 AM</strong> - Training session
                            </div>
                            <div class="meal-time">
                                <strong>9:30 AM</strong> - Post-workout nutrition
                            </div>
                            <div class="meal-time">
                                <strong>12:30 PM</strong> - Lunch
                            </div>
                            <div class="meal-time">
                                <strong>4:00 PM</strong> - Afternoon snack
                            </div>
                            <div class="meal-time">
                                <strong>7:00 PM</strong> - Dinner
                            </div>
                        </div>
                    </div>
                </div>
                <% } else { %>
                <!-- Basic Member Content -->
                <div class="nutrition-card">
                    <h3>Upgrade for Personalized Plans</h3>
                    <p>Unlock custom macro calculations, advanced meal timing, and personalized supplement stacks.</p>
                    <div class="upgrade-cta">
                        <a href="/membership" class="upgrade-button">
                            <i class="fas fa-crown"></i>
                            Upgrade Membership
                        </a>
                    </div>
                </div>
                <% } %>

                <div class="nutrition-card">
                    <h3>Weekly Nutrition Challenge</h3>
                    <p>This week's focus: Increase vegetable intake to 5+ servings daily</p>
                    <div class="challenge-tracker">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 30%;"></div>
                        </div>
                        <span class="progress-text">3/5 days completed</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-column">
                <h3>GymRats</h3>
                <ul>
                    <li><a href="/about">About Us</a></li>
                    <li><a href="/trainers">Our Trainers</a></li>
                    <li><a href="/testimonial">Testimonials</a></li>
                    <li><a href="/blog">Blog</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h3>Resources</h3>
                <ul>
                    <li><a href="/isolation">Exercise Guide</a></li>
                    <li><a href="/nutrition">Nutrition Tips</a></li>
                    <li><a href="/workout_plans">Workout Plans</a></li>
                    <li><a href="/calculators">Calculators</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h3>Support</h3>
                <ul>
                    <li><a href="/contact">Contact Us</a></li>
                    <li><a href="/about">About us</a></li>
                    <li><a href="/terms">Terms of Service</a></li>
                    <li><a href="/privacy_policy">Privacy Policy</a></li>
                </ul>
            </div>

            <div class="footer-column">
                <h3>Connect With Us</h3>
                <ul>
                    <li><a href="/trainer_form">Become a Trainer</a></li>
                    <li><a href="/verifier_form">Become a Verifier</a></li>
                </ul>
                <div class="social-icons">
                    <a href="#"><img src="/home/icons8-facebook.svg" alt="Facebook"></a>
                    <a href="#"><img src="/home/icons8-instagram.svg" alt="Instagram"></a>
                    <a href="#"><img src="/home/icons8-youtube.svg" alt="YouTube"></a>
                </div>
                <p class="copyright">GymRats © 2025. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            document.getElementById('menuIcon').addEventListener('click', function() {
                document.getElementById('sideNavbar').classList.add('open');
            });

            document.getElementById('closeBtn').addEventListener('click', function() {
                document.getElementById('sideNavbar').classList.remove('open');
            });

            // Progress tracking for weekly challenge
            const challengeDays = document.querySelectorAll('.challenge-day');
            challengeDays.forEach(day => {
                day.addEventListener('click', function() {
                    this.classList.toggle('completed');
                    updateProgress();
                });
            });

            function updateProgress() {
                const completed = document.querySelectorAll('.challenge-day.completed').length;
                const total = challengeDays.length;
                const progress = (completed / total) * 100;
                
                document.querySelector('.progress-fill').style.width = `${progress}%`;
                document.querySelector('.progress-text').textContent = `${completed}/${total} days completed`;
            }
        });
    </script>
</body>
</html>