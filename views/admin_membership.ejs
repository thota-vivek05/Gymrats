<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymRats - Membership Management</title>
    <link rel="stylesheet" href="/admin/admin.css">
    <link rel="stylesheet" href="/admin/admin_membership.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap">
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="/home" class="brand-name">GymRats</a>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/admin_dashboard" class="nav-link">
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin_user" class="nav-link">
                        <span>Users</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin_trainers" class="nav-link">
                        <span>Trainers</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin_membership" class="nav-link active">
                        <span>Memberships</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin_nutrition" class="nav-link">
                        <span>Nutrition Plans</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin_exercises" class="nav-link">
                        <span>Exercises</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin_workouts" class="nav-link">
                        <span>Workout Plans</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin_verifier" class="nav-link">
                        <span>Verifiers</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin_settings" class="nav-link">
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </aside>
        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Header -->
            <div class="header">
                <h2>Membership Management</h2>
                <div class="right-container">
                    <div class="search-container">
                        <img src="https://img.icons8.com/ios/250/8A2BE2/search--v1.png" height="18px" alt="Search Icon" />
                        <input type="text" placeholder="Search..." size="20" style="font-size: 14px;" />
                    </div>
                    <div class="user-info">
                        <div class="avatar">A</div>
                        <span>Admin</span>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-container">
                <div class="stats-card">
                    <div class="stats-content">
                        <div class="stats-info">
                            <div class="stats-header">
                                <h3>Total Revenue</h3>
                            </div>
                            <div class="stats-number">$<%= stats.totalRevenue.toLocaleString() %></div>
                            <div class="stats-label">+8% from last month</div>
                        </div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stats-content">
                        <div class="stats-info">
                            <div class="stats-header">
                                <h3>Active Members</h3>
                            </div>
                            <div class="stats-number"><%= stats.activeMembers.toLocaleString() %></div>
                            <div class="stats-label">+5% from last month</div>
                        </div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stats-content">
                        <div class="stats-info">
                            <div class="stats-header">
                                <h3>Premium Members</h3>
                            </div>
                            <div class="stats-number"><%= stats.premiumMembers.toLocaleString() %></div>
                            <div class="stats-label">+12% from last month</div>
                        </div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stats-content">
                        <div class="stats-info">
                            <div class="stats-header">
                                <h3>New Sign-ups</h3>
                            </div>
                            <div class="stats-number"><%= stats.newSignups.toLocaleString() %></div>
                            <div class="stats-label">+5% from last week</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Membership Plans Cards -->
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">Membership Plans</h3>
                </div>
                
                <div class="membership-grid">
                    <!-- Basic Plan Card -->
                    <div class="membership-card basic-card">
                        <div class="membership-header">
                            <h3 class="membership-title basic-title">Basic</h3>
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 6H4V18H20V6Z" stroke="#4CAF50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="membership-price">
                            <span class="price-currency">$</span>19<span class="price-period">/month</span>
                        </div>
                        <div class="membership-details">
                            <div class="membership-feature">
                                <svg class="feature-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#4CAF50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Access to gym equipment</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#4CAF50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Basic workout programs</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#4CAF50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Access to locker rooms</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 6L6 18M6 6L18 18" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Personal training sessions</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 6L6 18M6 6L18 18" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Nutrition counseling</span>
                            </div>
                        </div>

                        <div class="membership-stats">
                            <div class="stat-item">
                                <span class="stat-label">Active Members</span>
                                <span class="stat-value"><%= planStats.basic.active.toLocaleString() %></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Revenue</span>
                                <span class="stat-value">$<%= planStats.basic.revenue.toLocaleString() %></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Avg. Retention</span>
                                <span class="stat-value"><%= planStats.basic.retention.toFixed(1) %> months</span>
                            </div>
                        </div>

                        <div class="membership-actions">
                            <button class="edit-btn" data-plan="basic">Edit Plan</button>
                            <a href="#" class="view-all-btn">View Members</a>
                        </div>
                    </div>

                    <!-- Gold Plan Card -->
                    <div class="membership-card gold-card">
                        <div class="membership-header">
                            <h3 class="membership-title gold-title">Gold</h3>
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 15C15.866 15 19 11.866 19 8C19 4.13401 15.866 1 12 1C8.13401 1 5 4.13401 5 8C5 11.866 8.13401 15 12 15Z" stroke="#FFC107" stroke-width="2"/>
                                <path d="M8.21 13.89L7 23L12 20L17 23L15.79 13.88" stroke="#FFC107" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="membership-price">
                            <span class="price-currency">$</span>39<span class="price-period">/month</span>
                        </div>
                        <div class="membership-details">
                            <div class="membership-feature">
                                <svg class="feature-icon gold-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#FFC107" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>All Basic features</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon gold-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#FFC107" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>1 personal training session/month</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon gold-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#FFC107" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Access to group classes</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon gold-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#FFC107" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Advanced workout programs</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 6L6 18M6 6L18 18" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Nutrition planning</span>
                            </div>
                        </div>

                        <div class="membership-stats">
                            <div class="stat-item">
                                <span class="stat-label">Active Members</span>
                                <span class="stat-value"><%= planStats.gold.active.toLocaleString() %></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Revenue</span>
                                <span class="stat-value">$<%= planStats.gold.revenue.toLocaleString() %></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Avg. Retention</span>
                                <span class="stat-value"><%= planStats.gold.retention.toFixed(1) %> months</span>
                            </div>
                        </div>

                        <div class="membership-actions">
                            <button class="edit-btn" data-plan="gold">Edit Plan</button>
                            <a href="#" class="view-all-btn">View Members</a>
                        </div>
                    </div>

                    <!-- Platinum Plan Card -->
                    <div class="membership-card platinum-card">
                        <div class="membership-header">
                            <h3 class="membership-title platinum-title">Platinum</h3>
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="#8A2BE2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="membership-price">
                            <span class="price-currency">$</span>79<span class="price-period">/month</span>
                        </div>
                        <div class="membership-details">
                            <div class="membership-feature">
                                <svg class="feature-icon platinum-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#8A2BE2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>All Gold features</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon platinum-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#8A2BE2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Weekly personal training</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon platinum-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#8A2BE2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Personalized nutrition plan</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon platinum-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#8A2BE2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Premium locker service</span>
                            </div>
                            <div class="membership-feature">
                                <svg class="feature-icon platinum-feature" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="#8A2BE2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Unlimited guest passes</span>
                            </div>
                        </div>

                        <div class="membership-stats">
                            <div class="stat-item">
                                <span class="stat-label">Active Members</span>
                                <span class="stat-value"><%= planStats.platinum.active.toLocaleString() %></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Revenue</span>
                                <span class="stat-value">$<%= planStats.platinum.revenue.toLocaleString() %></span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Avg. Retention</span>
                                <span class="stat-value"><%= planStats.platinum.retention.toFixed(1) %> months</span>
                            </div>
                        </div>

                        <div class="membership-actions">
                            <button class="edit-btn" data-plan="platinum">Edit Plan</button>
                            <a href="#" class="view-all-btn">View Members</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Charts -->
            <div class="section">
                <div class="section-header">
                    <h3 class="section-title">Membership Analytics</h3>
                </div>
                
                <div class="chart-grid">
                    <div class="chart-card">
                        <h4 class="chart-title">Revenue Distribution</h4>
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <h4 class="chart-title">Member Distribution</h4>
                        <div class="chart-container">
                            <canvas id="membershipChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <h4 class="chart-title">Monthly Sign-ups</h4>
                        <div class="chart-container">
                            <canvas id="signupChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <h4 class="chart-title">Member Retention Rate</h4>
                        <div class="chart-container">
                            <canvas id="retentionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Member Management -->
            <div class="section members-table">
                <div class="table-header">
                    <h3 class="table-title">Member Management</h3>
                </div>
                
                <!-- Tab Navigation -->
                <div class="tab-container">
                    <button class="tab active" data-tab="all-members">All Members</button>
                    <button class="tab basic-tab" data-tab="basic-members">Basic</button>
                    <button class="tab gold-tab" data-tab="gold-members">Gold</button>
                    <button class="tab platinum-tab" data-tab="platinum-members">Platinum</button>
                    <button class="tab" data-tab="expired-members">Expired</button>
                </div>
                
                <!-- Search Bar -->
                <div class="search-container">
                    <div class="search-bar">
                        <input type="text" id="memberSearchInput" placeholder="Search by name...">
                    </div>
                    <button class="filter-btn" id="filterBtn">Filter Options</button>
                </div>
                
                <!-- Member Table -->
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Plan</th>
                                <th>Join Date</th>
                                <th>Renewal Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="memberTableBody">
                            <% if (memberships && memberships.length > 0) { %>
                            <% memberships.forEach(mem => { %>
                            <tr>
                                <td><%= mem.user_id.full_name %></td>
                                <td><%= mem.user_id.email %></td>
                                <td><%= mem.type %></td>
                                <td><%= new Date(mem.start_date).toLocaleDateString() %></td>
                                <td><%= new Date(mem.end_date).toLocaleDateString() %></td>
                                <td><span class="status <%= mem.status.toLowerCase() %>"><%= mem.status %></span></td>
                                <td>
                                    <button class="action-btn">View</button>
                                    <button class="action-btn"><%= mem.status === 'Active' ? 'Edit' : 'Renew' %></button>
                                </td>
                            </tr>
                            <% }); %>
                            <% } else { %>
                            <tr>
                                <td colspan="7" class="no-data">No memberships found</td>
                            </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="pagination">
                    <button class="page-btn active">1</button>
                    <button class="page-btn">2</button>
                    <button class="page-btn">3</button>
                    <button class="page-btn">Next</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Membership Plan Modal -->
    <div id="editPlanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Edit Membership Plan</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editPlanForm">
                <input type="hidden" id="planType" name="planType" value="">
                
                <div class="form-group">
                    <label for="planName">Plan Name</label>
                    <input type="text" id="planName" name="planName" disabled>
                </div>
                
                <div class="form-group">
                    <label for="planPrice">Monthly Price ($)</label>
                    <input type="number" id="planPrice" name="planPrice" min="0" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label for="planDescription">Description</label>
                    <textarea id="planDescription" name="planDescription" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="planFeatures">Features (one per line)</label>
                    <textarea id="planFeatures" name="planFeatures" rows="5"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="planStatus">Status</label>
                    <select id="planStatus" name="planStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="cancel-btn">Cancel</button>
                    <button type="submit" class="save-btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setupTabNavigation();
            setupModalFunctionality();
            setupChartsData();
            setupActionButtons();
            setupSearch();
        });

        function setupTabNavigation() {
            const tabs = document.querySelectorAll('.tab');
            const userRows = document.querySelectorAll('#memberTableBody tr');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const tabType = this.getAttribute('data-tab');
                    
                    userRows.forEach(row => {
                        const planType = row.children[2]?.textContent.toLowerCase() || '';
                        const status = row.querySelector('.status')?.textContent.toLowerCase() || '';
                        
                        switch(tabType) {
                            case 'all-members':
                                row.style.display = '';
                                break;
                            case 'basic-members':
                                row.style.display = (planType === 'basic') ? '' : 'none';
                                break;
                            case 'gold-members':
                                row.style.display = (planType === 'gold') ? '' : 'none';
                                break;
                            case 'platinum-members':
                                row.style.display = (planType === 'platinum') ? '' : 'none';
                                break;
                            case 'expired-members':
                                row.style.display = (status === 'expired') ? '' : 'none';
                                break;
                        }
                    });
                });
            });
        }

        function setupModalFunctionality() {
            const modal = document.getElementById('editPlanModal');
            const editButtons = document.querySelectorAll('.edit-btn');
            const closeButton = document.querySelector('.close-modal');
            const cancelButton = document.querySelector('.cancel-btn');
            const form = document.getElementById('editPlanForm');
            
            editButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const planType = this.getAttribute('data-plan');
                    
                    document.getElementById('planType').value = planType;
                    
                    switch(planType) {
                        case 'basic':
                            document.getElementById('planName').value = 'Basic';
                            document.getElementById('planPrice').value = '19.00';
                            document.getElementById('planDescription').value = 'Basic membership plan with access to gym equipment and basic workout programs.';
                            document.getElementById('planFeatures').value = 'Access to gym equipment\nBasic workout programs\nAccess to locker rooms';
                            document.getElementById('modalTitle').textContent = 'Edit Basic Plan';
                            break;
                        case 'gold':
                            document.getElementById('planName').value = 'Gold';
                            document.getElementById('planPrice').value = '39.00';
                            document.getElementById('planDescription').value = 'Intermediate membership plan with personal training and group classes.';
                            document.getElementById('planFeatures').value = 'All Basic features\n1 personal training session/month\nAccess to group classes\nAdvanced workout programs';
                            document.getElementById('modalTitle').textContent = 'Edit Gold Plan';
                            break;
                        case 'platinum':
                            document.getElementById('planName').value = 'Platinum';
                            document.getElementById('planPrice').value = '79.00';
                            document.getElementById('planDescription').value = 'Premium membership plan with weekly personal training and nutrition planning.';
                            document.getElementById('planFeatures').value = 'All Gold features\nWeekly personal training\nPersonalized nutrition plan\nPremium locker service\nUnlimited guest passes';
                            document.getElementById('modalTitle').textContent = 'Edit Platinum Plan';
                            break;
                    }
                    
                    modal.style.display = 'flex';
                });
            });
            
            closeButton.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            cancelButton.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                
                const planType = document.getElementById('planType').value;
                const planPrice = document.getElementById('planPrice').value;
                
                if (planType === 'basic') {
                    const basicPrice = document.querySelector('.basic-card .membership-price');
                    basicPrice.innerHTML = `<span class="price-currency">$</span>${planPrice}<span class="price-period">/month</span>`;
                } else if (planType === 'gold') {
                    const goldPrice = document.querySelector('.gold-card .membership-price');
                    goldPrice.innerHTML = `<span class="price-currency">$</span>${planPrice}<span class="price-period">/month</span>`;
                } else if (planType === 'platinum') {
                    const platinumPrice = document.querySelector('.platinum-card .membership-price');
                    platinumPrice.innerHTML = `<span class="price-currency">$</span>${planPrice}<span class="price-period">/month</span>`;
                }
                
                modal.style.display = 'none';
                
                alert(`${planType.charAt(0).toUpperCase() + planType.slice(1)} plan updated successfully!`);
            });
        }

        function setupChartsData() {
            // Revenue Distribution Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Basic', 'Gold', 'Platinum'],
                    datasets: [{
                        label: 'Revenue',
                        data: [<%= planStats.basic.revenue %>, <%= planStats.gold.revenue %>, <%= planStats.platinum.revenue %>],
                        backgroundColor: [
                            '#4CAF50',
                            '#FFC107',
                            '#8A2BE2'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14
                                },
                                color: '#f1f1f1'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            // Member Distribution Chart
            const membershipCtx = document.getElementById('membershipChart').getContext('2d');
            new Chart(membershipCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Basic', 'Gold', 'Platinum'],
                    datasets: [{
                        label: 'Members',
                        data: [<%= planStats.basic.active %>, <%= planStats.gold.active %>, <%= planStats.platinum.active %>],
                        backgroundColor: [
                            '#4CAF50',
                            '#FFC107',
                            '#8A2BE2'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14
                                },
                                color: '#f1f1f1'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + ' members';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            // Monthly Sign-ups Chart
            const signupCtx = document.getElementById('signupChart').getContext('2d');
            new Chart(signupCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'Basic',
                            data: [220, 185, 210, 250, 280, 230, 245, 270, 290, 310, 330, 350],
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            fill: true
                        },
                        {
                            label: 'Gold',
                            data: [120, 135, 150, 160, 175, 185, 170, 190, 210, 185, 205, 220],
                            borderColor: '#FFC107',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            fill: true
                        },
                        {
                            label: 'Platinum',
                            data: [40, 45, 50, 65, 70, 60, 75, 80, 85, 90, 95, 110],
                            borderColor: '#8A2BE2',
                            backgroundColor: 'rgba(138, 43, 226, 0.1)',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#f1f1f1'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#f1f1f1'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#f1f1f1'
                            }
                        }
                    }
                }
            });
            
            // Retention Rate Chart
            const retentionCtx = document.getElementById('retentionChart').getContext('2d');
            new Chart(retentionCtx, {
                type: 'bar',
                data: {
                    labels: ['Basic', 'Gold', 'Platinum'],
                    datasets: [{
                        label: 'Average Retention (months)',
                        data: [<%= planStats.basic.retention %>, <%= planStats.gold.retention %>, <%= planStats.platinum.retention %>],
                        backgroundColor: [
                            '#4CAF50',
                            '#FFC107',
                            '#8A2BE2'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#f1f1f1'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#f1f1f1'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function setupActionButtons() {
            const viewButtons = document.querySelectorAll('.view-all-btn');
            viewButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const card = this.closest('.membership-card');
                    let planType = '';
                    
                    if (card.classList.contains('basic-card')) {
                        planType = 'basic';
                    } else if (card.classList.contains('gold-card')) {
                        planType = 'gold';
                    } else if (card.classList.contains('platinum-card')) {
                        planType = 'platinum';
                    }
                    
                    const tabs = document.querySelectorAll('.tab');
                    tabs.forEach(tab => {
                        if (tab.getAttribute('data-tab') === `${planType}-members`) {
                            tab.click();
                            document.querySelector('.members-table').scrollIntoView({ behavior: 'smooth' });
                        }
                    });
                });
            });
            
            const actionButtons = document.querySelectorAll('.action-btn');
            actionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const action = this.textContent.trim();
                    const row = this.closest('tr');
                    const memberName = row.children[0].textContent;
                    
                    if (action === 'View') {
                        alert(`Viewing details for ${memberName}`);
                    } else if (action === 'Edit') {
                        alert(`Editing details for ${memberName}`);
                    } else if (action === 'Renew') {
                        const statusCell = row.querySelector('.status');
                        statusCell.textContent = 'Active';
                        statusCell.className = 'status active';
                        alert(`Membership renewed for ${memberName}`);
                    }
                });
            });
            
            const filterBtn = document.getElementById('filterBtn');
            if (filterBtn) {
                filterBtn.addEventListener('click', function() {
                    alert('Filter options would appear here');
                });
            }
        }

        function setupSearch() {
            const searchInput = document.getElementById('memberSearchInput');
            const userTableBody = document.getElementById('memberTableBody');
            const userRows = document.querySelectorAll('#memberTableBody tr');
            const noDataRow = userTableBody.querySelector('.no-data');

            if (searchInput) {
                searchInput.addEventListener('input', function () {
                    const searchTerm = this.value.trim().toLowerCase();
                    let visibleRows = 0;

                    userRows.forEach(row => {
                        if (row.classList.contains('no-data')) return;

                        const userName = row.querySelector('td:first-child')?.textContent.toLowerCase() || '';

                        if (searchTerm === '' || userName.includes(searchTerm)) {
                            row.style.display = '';
                            visibleRows++;
                        } else {
                            row.style.display = 'none';
                        }
                    });

                    if (noDataRow) {
                        noDataRow.style.display = visibleRows === 0 && searchTerm !== '' ? '' : 'none';
                    }
                });
            }
        }
    </script>
</body>
</html>